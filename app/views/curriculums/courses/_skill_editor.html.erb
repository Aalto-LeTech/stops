<div class="row-fluid full-height">

  <!-- Prereqs -->
  <div class="span6 full-height scroll-vertical">
    <h2><%=t '.prereqs_heading' %></h2>
    
    <div class="input-append bottom-weight">
      <input class="span8" type="text" id="search" placeholder="<%= t '.search_box_placeholder' %>" data-bind="value: searchString, valueUpdate: 'keyup', event: { keyup: searchKeyPress }" />
      <button class="btn" data-bind="click: clickSearch"><i class="icon-search"></i></button>
      <button class="btn" data-bind="click: clickClearSearch"><i class="icon-remove"></i></button>
    </div>
    
    <!-- Error alert box -->
    <div class="row-fluid hide" data-bind="css: { hide: loadFailed() === false }">
      <div class="alert alert-error span11">
        <strong><%= t '.load_failed_heading' %></strong> <%= t '.search_failure_message' %>
      </div>
    </div>

    <!-- loading icon -->
    <div class="skill-editor-loading-icon hide" data-bind="css: { hide: isLoading() === false }">
      <%= image_tag 'progress.gif' %>
    </div>

    <div data-bind="foreach: visibleNodes">
      
      <div class="course">
        <p><span data-bind="text: code"></span> <span data-bind="text: localizedName"></span> <span class="pull-right" data-bind="text: localizedType"></span></p>
        <!-- ko foreach: skills -->
          <div class="skill" data-bind="css: { 
              selected: selected(), 
              supporting: prereqType() === 0, 
              strict: prereqType() === 1,
              loading: isLoading()
            }">
            <div class="buttons">
              <span data-bind="click: clickToggleSupportingPrereq" class="supportingPrereqButton"><%=t('.supportingPrereqButton') %></span>
              <span data-bind="click: clickToggleStrictPrereq" class="strictPrereqButton"><%=t('.strictPrereqButton') %></span>
            </div>
            <span data-bind="text: localizedDescription"></span>
          </div>
        <!-- /ko -->
      </div>
      
    </div>
  </div>
  
  <!-- Outcomes -->
  <div class="span6">
    <h2><%=t '.outcomes_heading' %></h2>

    <!-- Error alert box -->
    <div class="row-fluid hide" data-bind="css: { hide: targetNodeLoadFailed() === false }">
      <div class="alert alert-error span11">
        <strong><%= t '.load_failed_heading' %></strong> <%= t '.node_load_failure_message' %>
      </div>
    </div>
    
    <!-- loading icon -->
    <div class="skill-editor-loading-icon" data-bind="css: { hide: targetNodeIsLoading() === false }">
      <%= image_tag 'progress.gif' %>
    </div>

    <div id="target-node" class="course"
      data-node-id="<%= @competence_node.id %>" 
      data-url="<%= @competence_node_url %>">
      <!-- ko with: node -->
        <p><span data-bind="text: code"></span> <span data-bind="text: localizedName"></span></p>
        <!-- ko foreach: skills -->
          <div class="skill" data-bind="click: clickSelectTarget, css: { selected: selected() }">
            <div class="buttons">
              <i class="icon-pencil" data-bind="click: clickEdit" title="<%=t '.edit_skill' %>"></i>
              <i class="icon-trash" data-bind="click: clickDelete, clickBubble: false" title="<%=t '.remove_skill' %>"></i>
            </div>
            <span data-bind="text: localizedDescription"></span>
          </div>
        <!-- /ko -->
      <!-- /ko -->
      
      <p><button class="btn btn-mini" data-bind="click: $root.clickAddSkill"><i class="icon-plus"></i> <%=t '.add_skill' %></button></p>
    </div>
    
  </div>

</div>

<p><%= link_to t(:Back), edit_curriculum_path(@curriculum) %></p>

<!-- Skill editor modal -->
<div id="modal-edit-skill" class="modal hide" 
  data-current-locale="<%= I18n.locale %>" 
  data-locales="<%= REQUIRED_LOCALES.join(',') %>" 
  data-curriculum-url="<%= curriculum_path(@curriculum) %>">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3><%= @competence_node.localized_description.name %> - <%= t('.add_skill') %></h3>
    </div>
    <div class="modal-body">
      <div class="form-horizontal">
        <!-- ko with: currentlyEditedSkill -->
          <!-- ko foreach: descriptions -->
            <div class="control-group">
              <label class="control-label">
                <span data-bind="text: localizedLocale"></span>
              </label>
              <div class="controls">
                <input type="text" class="input-xlarge" data-bind="value: description" />
              </div>
            </div>
          <!-- /ko -->
        <!-- /ko -->

        <div class="control-group">
          <div class="controls">
            <button class="btn" data-dismiss="modal" aria-hidden="true"><%= t(:Cancel) %></button>
            <button class="btn btn-primary" data-bind="click: clickSaveSkill"><%= t(:Save) %></button>
          </div>
        </div>
      </div>
      
      <%= render :partial => 'curriculums/courses/bloom_instructions' %>
    </div>
    <!--
    <div class="modal-footer">
    </div>
    -->
</div>

<!-- Deletion confirmation modal -->
<div id="modal-confirm-skill-deletion" class="modal hide" data-bind="showModal: showDeletionConfirmationModal, with: currentlyEditedSkill">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h4 data-bind="text: generateDeletionConfirmationString()"></h4>
  </div>
  <div class="modal-body">
    <p>
      <!-- ko if: prereqToIds.length <= 0 -->
        <span class="badge badge-success"><i class="icon-ok icon-white"></i></span>
        <span data-bind="text: $root.i18n['delete_skill_no_dependencies']"></span>
      <!-- /ko -->
      <!-- ko if: prereqToIds.length > 0 -->
        <span class="badge badge-important">!</span>
        <span data-bind="text: $root.i18n['delete_skill_dependency_warning_pre']"></span>
        <span data-bind="text: prereqToIds.length"></span>
        <span data-bind="text: $root.i18n['delete_skill_dependency_warning_post']"></span>
      <!-- /ko -->
    </p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal"><%= t :Cancel %></button>
    <button class="btn btn-danger" data-bind="click: clickConfirmDeletion"><%= t '.delete_skill' %></button>
  </div>
</div

