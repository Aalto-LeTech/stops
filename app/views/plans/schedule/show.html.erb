<% content_for(:stylesheets) do %>
  <%= stylesheet_link_tag "views/plans/schedule/show", :media => 'all' %>
<% end %>

<% content_for(:javascripts) do %>
  <script type="text/javascript">
    <%= render "show_i18n_strings.js" %>
  </script>
  <%= javascript_include_tag 'views/plans/schedule/show' %>
<% end %>


<% content_for(:theleft) do %>

  <div class="container-fluid">

    <% # "Course locked" icon that will be cloned using JS. Do not include id on the element, because that will also be copied!
    %>
    <div id="cloneable-imgs" class="hide">
      <%= image_tag "glyphicons_203_lock.png", :class => "course-locked" %>
    </div>

    <div id="controls">
      <button id="save-button" class="btn pull-right" data-bind="click: save"><%= t('.save') %></button>
      <h2>
        <%= t('.scheduling') %>
      </h2>
      <p>
        <%= t('.curriculum') %>:
        <%= @study_plan.curriculum.name %>
        <%= @study_plan.curriculum.start_year %> -
        <%= @study_plan.curriculum.end_year %>
      </p>
    </div>

    <!-- Selected course details -->
    <!-- ko if: selectedObjectType() == 'Course' -->
      <div class="object-info well" data-bind="with: selectedObject">

        <h3>
          <%= t('.selected_course') %>
        </h3>

        <p>
          <span data-bind="text: code"></span>
          <span data-bind="text: name"></span>
        </p>

        <div id="length" class="row-fluid" data-toggle="tooltip" title="<%= t('.length_tooltip') %>">
          <div class="span6">
            <label for="length-input">
              <%= t('.length') %>:
            </label>
          </div>
          <div class="span6">
            <span id="in">
              <input id="length-input" class="input-mini" type="number" data-bind="value: length, valueUpdate: 'keyup'" />
            </span>
            <span id="out" data-bind="text: length"></span>
            <%= t('.prd') %>
          </div>
        </div>

        <div id="credits" class="row-fluid" data-toggle="tooltip" title="<%= t('.extent_tooltip') %>">
          <div class="span6">
            <label for="credits-input">
              <%= t('.extent') %>:
            </label>
          </div>
          <div class="span6">
            <span id="in">
              <input id="credits-input" class="input-mini" type="number" data-bind="value: credits, valueUpdate: 'keyup'" />
            </span>
            <span id="out" data-bind="text: credits"></span>
            <%= t('cr') %>
          </div>
        </div>

        <div id="grade" class="row-fluid" data-toggle="tooltip" title="<%= t('.grade_tooltip') %>">
          <div class="span6">
            <label for="grade-input">
              <%= t('.grade') %>:
            </label>
          </div>
          <div class="span6">
            <span id="in">
              <input id="grade-input" class="input-mini" type="number" data-bind="value: grade, valueUpdate: 'keyup'" />
            </span>
            <span id="out" data-bind="text: grade"></span>
          </div>
        </div>

        <h4><%= t('.prereqs') %></h4>

        <!-- ko if: hasPrereqs() -->
          <ul data-bind="foreach: getPrereqs()">
            <li>
              <span data-bind="text: code"></span>
              <span data-bind="text: name"></span>
            </li>
          </ul>
        <!-- /ko -->

        <span data-bind="ifnot: hasPrereqs()"><%= t('.no_prereqs') %></span>
        <span data-bind="ifnot: allPrereqsInPlan"><%= t('.not_all_prereqs_in_plan') %></span>

      </div>  <!-- object-info -->
    <!-- /ko -->

    <!-- Selected period details -->
    <!-- ko if: selectedObjectType() == 'Period' -->
      <div class="object-info well" data-bind="with: selectedObject">

        <h3>
          <%= t('.selected_period') %>
        </h3>

        <p>
          <span data-bind="text: name"></span>
        </p>
        <p class="muted">
          <span data-bind="text: beginsAt"></span>
          -
          <span data-bind="text: endsAt"></span>
        </p>

        <div id="period-courses">
          <h4><%= t('.scheduled_courses') %></h4>

          <!-- ko if: affectingCourses.length == 0 -->
            <p><%= t('.no_scheduled_courses') %></p>
          <!-- /ko -->
          <!-- ko if: affectingCourses.length > 0 -->
          <table class="table table-condensed">
            <thead>
              <th>
                <%= t('.code') %>
              </th>
              <th>
                <%= t('.name') %>
              </th>
              <th>
                <%= t('.extent') %>
              </th>
  <!--
              <th>
                <%= t('.length') %>
              </th>
              <th>
                <%= t('.grade') %>
              </th>
  -->
            </thead>
            <tbody data-bind="foreach: affectingCourses">
              <tr data-bind="css: {'old': period.isSelected() == false}">
                <td data-bind="text: code">
                </td>
                <td data-bind="text: name">
                </td>
                <td data-bind="text: credits">
                </td>
  <!--
                <td data-bind="text: length">
                </td>
                <td data-bind="text: grade">
                </td>
  -->
              </tr>
            </tbody>
            <tr>
              <td>
              </td>
              <td>
              </td>
              <td>
                <span data-bind="numeric: credits, decimals: 1"></span>
                <%= t('cr') %>
              </td>
            </tr>
          </table>
          <!-- /ko -->
        </div>
      </div>  <!-- object-info -->
    <!-- /ko -->

    <!-- Competence details -->
    <!-- ko if: selectedObjectType() == undefined || selectedObjectType() == 'Competence' -->
      <div class="object-info well">

        <h3>
          <%= t('.competences') %>
        </h3>

        <!-- ko if: competences.length == 0 -->
          <p><%= t('.no_chosen_competences') %></p>
        <!-- /ko -->
        <!-- ko if: competences.length > 0 -->
          <ul data-bind="foreach: competences">
            <li class="competencex">
              <div data-bind="css: {'selected': isSelected}">
                <span data-bind="text: name"></span>
              </div>
              <div class="progress progress-striped" title="<%= t('.competence_progress_tooltip') %>">
                <div class="bar" data-bind="style: {width: progressWidth()}"></div>
              </div>
            </li>
          </ul>
        <!-- /ko -->

      </div>  <!-- object-info -->
    <!-- /ko -->

  </div>

<% end %>


<div class="loader"></div>


<% if @study_plan.scoped_courses.empty? && @study_plan.competences.empty? %>
  <div class="alert">
    <%= link_to t('.empty_instructions'), studyplan_competences_path %>
  </div>
<% end %>

<p id="status"></p>

<div id="plan-container" data-studyplan-path="<%= plan_path(@study_plan.id) %>">

  <div id="svg"></div>

  <!-- ko foreach: periods -->
    <div class="period" data-bind="
        droppable: droppedCourse,
        position: position,
        css: { 'selected': isSelected,
               'receiver': isReceiver,
               'old': isOld,
               'now': isNow }"
    >
      <div class="name" data-bind="text: name"></div>
      <div class="credits"><span data-toggle="tooltip" data-bind="numeric: credits, decimals: 0, attr: {title: creditsTooltip}, css: creditsStatus"></span> <%= t('cr') %></div>
    </div>
  <!-- /ko -->

  <!-- ko foreach: courses -->
    <div class="course" data-toggle="tooltip" data-bind="draggable: {}, position: position, attr: {title: tooltip}, css: {'selected': isSelected, 'passed': grade() > 0, 'instanced': isInstanceBound, 'customized': isCustomized, 'prereq-of': hilightPrereq, 'prereq-to': hilightPrereqTo, 'misordered': isMisordered, 'misscheduled': isMisscheduled}">
      <!-- <div class="arrow prereq-arrow">&#x2b07;</div> -->
      <span data-bind="text: code"></span>
      <span data-bind="text: name"></span>
    </div>
  <!-- /ko -->

</div>
