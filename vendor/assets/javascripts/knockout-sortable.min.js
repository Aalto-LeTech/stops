//knockout-sortable 0.8.1 | (c) 2013 Ryan Niemeyer | http://www.opensource.org/licenses/mit-license
(function(e){typeof define=="function"&&define.amd?define(["knockout","jquery","jquery.ui.sortable"],e):e(window.ko,jQuery)})(function(e,t,n){var r="ko_sortItem",i="ko_sourceIndex",s="ko_sortList",o="ko_parentList",u="ko_dragItem",a=e.utils.unwrapObservable,f=e.utils.domData.get,l=e.utils.domData.set,c=function(t,n){e.utils.arrayForEach(t,function(e){e.nodeType===1&&(l(e,r,n),l(e,o,f(e.parentNode,s)))})},h=function(t,n){var r={},i=a(t()),s;return i.data?(r[n]=i.data,r.name=i.template):r[n]=t(),e.utils.arrayForEach(["afterAdd","afterRender","as","beforeRemove","includeDestroyed","templateEngine","templateOptions"],function(t){r[t]=i[t]||e.bindingHandlers.sortable[t]}),n==="foreach"&&(r.afterRender?(s=r.afterRender,r.afterRender=function(e,t){c.call(t,e,t),s.call(t,e,t)}):r.afterRender=c),r},p=function(e,t){var n=a(t);if(n)for(var r=0;r<e;r++)n[r]&&a(n[r]._destroy)&&e++;return e};e.bindingHandlers.sortable={init:function(c,d,v,m,g){var y=t(c),b=a(d())||{},w=h(d,"foreach"),E={},S,x;e.utils.arrayForEach(c.childNodes,function(e){e&&e.nodeType===3&&e.parentNode.removeChild(e)}),t.extend(!0,E,e.bindingHandlers.sortable),b.options&&E.options&&(e.utils.extend(E.options,b.options),delete b.options),e.utils.extend(E,b),E.connectClass&&(e.isObservable(E.allowDrop)||typeof E.allowDrop=="function")?e.computed({read:function(){var t=a(E.allowDrop),n=typeof t=="function"?t.call(this,w.foreach):t;e.utils.toggleDomNodeCssClass(c,E.connectClass,n)},disposeWhenNodeIsRemoved:c},this):e.utils.toggleDomNodeCssClass(c,E.connectClass,E.allowDrop),e.bindingHandlers.template.init(c,function(){return w},v,m,g),S=E.options.start,x=E.options.update;var T=setTimeout(function(){var h;y.sortable(e.utils.extend(E.options,{start:function(t,n){var r=n.item[0];l(r,i,e.utils.arrayIndexOf(n.item.parent().children(),r)),n.item.find("input:focus").change(),S&&S.apply(this,arguments)},receive:function(e,t){h=f(t.item[0],u),h&&(h.clone&&(h=h.clone()),E.dragged&&(h=E.dragged.call(this,h,e,t)||h))},update:function(n,u){var a,c,d,v,m,g=u.item[0],y=u.item.parent()[0],b=f(g,r)||h;h=null;if(b&&(this===y||t.contains(this,y))){a=f(g,o),d=f(g,i),c=f(g.parentNode,s),v=e.utils.arrayIndexOf(u.item.parent().children(),g),w.includeDestroyed||(d=p(d,a),v=p(v,c));if(E.beforeMove||E.afterMove)m={item:b,sourceParent:a,sourceParentNode:a&&u.sender||g.parentNode,sourceIndex:d,targetParent:c,targetIndex:v,cancelDrop:!1};if(E.beforeMove){E.beforeMove.call(this,m,n,u);if(m.cancelDrop){m.sourceParent?t(m.sourceParent===m.targetParent?this:u.sender).sortable("cancel"):t(g).remove();return}}v>=0&&(a&&(a.splice(d,1),e.processAllDeferredBindingUpdates&&e.processAllDeferredBindingUpdates()),c.splice(v,0,b)),l(g,r,null),u.item.remove(),e.processAllDeferredBindingUpdates&&e.processAllDeferredBindingUpdates(),E.afterMove&&E.afterMove.call(this,m,n,u)}x&&x.apply(this,arguments)},connectWith:E.connectClass?"."+E.connectClass:!1})),E.isEnabled!==n&&e.computed({read:function(){y.sortable(a(E.isEnabled)?"enable":"disable")},disposeWhenNodeIsRemoved:c})},0);return e.utils.domNodeDisposal.addDisposeCallback(c,function(){y.data("sortable")&&y.sortable("destroy"),clearTimeout(T)}),{controlsDescendantBindings:!0}},update:function(t,n,r,i,o){var u=h(n,"foreach");l(t,s,u.foreach),e.bindingHandlers.template.update(t,function(){return u},r,i,o)},connectClass:"ko_container",allowDrop:!0,afterMove:null,beforeMove:null,options:{}},e.bindingHandlers.draggable={init:function(r,i,s,o,f){var c=a(i())||{},p=c.options||{},d=e.utils.extend({},e.bindingHandlers.draggable.options),v=h(i,"data"),m=c.connectClass||e.bindingHandlers.draggable.connectClass,g=c.isEnabled!==n?c.isEnabled:e.bindingHandlers.draggable.isEnabled;return c=c.data||c,l(r,u,c),e.utils.extend(d,p),d.connectToSortable=m?"."+m:!1,t(r).draggable(d),g!==n&&e.computed({read:function(){t(r).draggable(a(g)?"enable":"disable")},disposeWhenNodeIsRemoved:r}),e.bindingHandlers.template.init(r,function(){return v},s,o,f)},update:function(t,n,r,i,s){var o=h(n,"data");return e.bindingHandlers.template.update(t,function(){return o},r,i,s)},connectClass:e.bindingHandlers.sortable.connectClass,options:{helper:"clone"}}})